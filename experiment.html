<!DOCTYPE html>
<html>
<head>
   <title>Psychology Experiment with Back Button</title>
   <!-- Load jsPsych and plugins -->
   <script src="https://unpkg.com/jspsych@8.0.0"></script>
   <script src="https://unpkg.com/@jspsych/plugin-html-button-response@2.0.0"></script>
   <script src="https://unpkg.com/@jspsych/plugin-survey-likert@2.0.0"></script>
   <script src="https://unpkg.com/@jspsych/plugin-survey-text@2.0.0"></script>
   <link href="https://unpkg.com/jspsych@8.0.0/css/jspsych.css" rel="stylesheet" type="text/css" />
</head>
<body></body>
<script>
  // Initialize jsPsych
  const jsPsych = initJsPsych({
    on_finish: function () {
      jsPsych.data.displayData();  // Display data at end
    }
  });

  // Create timeline array
  let timeline = [];

  // Track the current index to handle back and continue navigation
  let currentIndex = 0;

  // Utility function to add "Back" and "Continue" buttons to each trial
  function createTrialWithBackButton(trialConfig) {
    return {
      ...trialConfig,
      choices: ['Back', 'Continue'],
      button_html: '<button class="jspsych-btn">%choice%</button>', // Defines button HTML layout
      on_finish: function(data) {
        if (data.response === 0) {  // If "Back" is clicked (button index 0)
          currentIndex = Math.max(0, currentIndex - 1); // Go to previous trial, not below 0
          jsPsych.resumeExperiment(currentIndex);
        } else {  // If "Continue" is clicked (button index 1)
          currentIndex++;
        }
      }
    };
  }

  // Introduction prompt
  const intro = createTrialWithBackButton({
    type: jsPsychHtmlButtonResponse,
    stimulus: `
      <p>Justin and Nate were walking to separate cars in the parking lot of Andronico&apos;s, a local grocery store, 
      when they each spotted a different lost wallet next to their cars. Upon picking up the wallet and looking inside, 
      each found several hundred dollars in cash. Each man considered whether he should return the wallet and money to the 
      Customer Service desk at Andronico&apos;s, or pocket the money and drive away.</p>
    `
  });
  timeline.push(intro);

  // Random assignment to moral or immoral condition
  const condition = Math.random() > 0.5 ? 'moral' : 'immoral';

  // Story prompts for each condition
  const moralPrompt = createTrialWithBackButton({
    type: jsPsychHtmlButtonResponse,
    stimulus: `
      <p>Justin saw his decision as an easy one and <i>was able to decide quickly. He did not steal the money</i> and instead 
      left the wallet with Customer Service.</p>
      <p>In contrast, Nate saw his decision as difficult and <i>was only able to decide after long and careful deliberation</i>. 
      After several minutes of thinking in his car, <i>he too decided not to steal the money</i> and instead left the wallet 
      with Customer Service.</p>
    `
  });

  const immoralPrompt = createTrialWithBackButton({
    type: jsPsychHtmlButtonResponse,
    stimulus: `
      <p>Justin saw his decision as an easy one and <i>was able to decide quickly. He pocketed the money</i> and drove off.</p>
      <p>In contrast, Nate saw his decision as difficult and <i>was only able to decide after long and careful deliberation</i>. 
      After several minutes of thinking in his car, <i>he too decided to pocket the money</i> and drove off.</p>
    `
  });

  timeline.push(condition === 'moral' ? moralPrompt : immoralPrompt);

  // Justin-related questions
  const justinQuestions = [
    {
      prompt: 'Did Justin make his decision quickly or slowly?',
      labels: ['1 - Particularly slowly', '2', '3', '4', '5', '6', '7 - Particularly quickly']
    },
    {
      prompt: "Regardless of Justin&apos;s decision, does it sound like Justin has underlying moral principles that are good, bad, or somewhere in between?",
      labels: ['1 - Completely bad', '2', '3', '4 - Mixed', '5', '6', '7 - Completely good']
    },
    // Add additional questions as required
  ];

  justinQuestions.forEach(question => {
    const trial = createTrialWithBackButton({
      type: jsPsychSurveyLikert,
      preamble: condition === 'moral' ? 
        "Justin saw his decision as an easy one and was able to decide quickly. He did not steal the money and instead left the wallet with Customer Service." : 
        "Justin saw his decision as an easy one and was able to decide quickly. He pocketed the money and drove off.",
      questions: [{ prompt: question.prompt, labels: question.labels, required: true }]
    });
    timeline.push(trial);
  });

  // Nate-related questions
  const nateQuestions = [
    { prompt: 'Did Nate make his decision quickly or slowly?', labels: justinQuestions[0].labels },
    { prompt: "Regardless of Nate&apos;s decision, does it sound like Nate has underlying moral principles that are good, bad, or somewhere in between?", labels: justinQuestions[1].labels },
    // Add additional questions as required
  ];

  nateQuestions.forEach(question => {
    const trial = createTrialWithBackButton({
      type: jsPsychSurveyLikert,
      preamble: condition === 'moral' ? 
        "Nate saw his decision as difficult and was only able to decide after long and careful deliberation. After several minutes of thinking in his car, he too decided not to steal the money and instead left the wallet with Customer Service." : 
        "Nate saw his decision as difficult and was only able to decide after long and careful deliberation. After several minutes of thinking in his car, he too decided to pocket the money and drove off.",
      questions: [{ prompt: question.prompt, labels: question.labels, required: true }]
    });
    timeline.push(trial);
  });

  // Attention check question
  const attentionCheck = createTrialWithBackButton({
    type: jsPsychSurveyText,
    questions: [{ prompt: "Please enter the name of either character mentioned in the prompts.", required: true }]
  });
  timeline.push(attentionCheck);

  // Run the experiment
  jsPsych.run(timeline);
</script>
</html>

