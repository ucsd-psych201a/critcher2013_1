<!DOCTYPE html>
<html>
<head>
    <title>jsPsych Survey</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspsych/7.2.3/jspsych.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspsych/7.2.3/plugins/jspsych-html-keyboard-response.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspsych/7.2.3/plugins/jspsych-html-slider-response.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspsych/7.2.3/plugins/jspsych-survey-text.min.js"></script>
</head>
<body></body>
<script>
    var jsPsych = initJsPsych({
        on_finish: function () {
            jsPsych.data.displayData();
        }
    });
    
    // Create the jsPsych timeline
    var timeline = [];

    // Initial prompt
    var initial_prompt = {
        type: 'html-keyboard-response',
        stimulus: `<p>Justin and Nate were walking to separate cars in the parking lot of Andronico’s, a local grocery store, 
        when they each spotted a different lost wallet next to their cars. Upon picking up the wallet and looking inside, each found 
        several hundred dollars in cash. Each man considered whether he should return the wallet and money to the Customer Service desk 
        at Andronico’s, or pocket the money and drive away.</p><p>Press any key to continue.</p>`
    };
    timeline.push(initial_prompt);

    // Random condition assignment
    var condition = Math.random() < 0.5 ? 'moral' : 'immoral';

    // Conditional prompts
    var moral_prompt = {
        justin: `<p>Justin saw his decision as an easy one and was able to decide quickly. He did not steal the money and instead left the wallet with Customer Service.</p>`,
        nate: `<p>Nate saw his decision as difficult and was only able to decide after long and careful deliberation. After several minutes of thinking in his car, he too decided not to steal the money and instead left the wallet with Customer Service.</p>`
    };

    var immoral_prompt = {
        justin: `<p>Justin saw his decision as an easy one and was able to decide quickly. He pocketed the money and drove off.</p>`,
        nate: `<p>Nate saw his decision as difficult and was only able to decide after long and careful deliberation. After several minutes of thinking in his car, he too decided to pocket the money and drive off.</p>`
    };

    var chosen_prompts = condition === 'moral' ? moral_prompt : immoral_prompt;

    // Justin questions
    var justin_questions = [
        'Did Justin make his decision quickly or slowly?',
        'Regardless of Justin\'s decision, does it sound like Justin has underlying moral principles that are good, bad, or somewhere in between?',
        'Regardless of Justin\'s decision, do you think Justin has moral standards that are good, bad, or somewhere in between?',
        'Regardless of Justin\'s decision, do you think Justin possesses the moral knowledge and principles necessary to do ‘the right thing’?',
        'Would you say Justin was quite certain in his decision, or did Justin have hesitations about his or her decision?',
        'How close do you think Justin was to choosing the alternate course of action?',
        'How conflicted do you think Justin felt in making the decision?',
        'Based on the information provided, do you think Justin had many reservations about the decision?',
        'Do you think Justin was calm and emotionally contained while making the decision?',
        'To what extent do you think Justin became upset and acted without thinking?'
    ];

    justin_questions.forEach(question => {
        timeline.push({
            type: 'html-slider-response',
            stimulus: chosen_prompts.justin + `<p>${question} (1 = particularly slowly, 7 = particularly quickly)</p>`,
            labels: ['1', '2', '3', '4', '5', '6', '7'],
            min: 1,
            max: 7
        });
    });

    // Nate questions
    var nate_questions = [
        'Did Nate make his decision quickly or slowly?',
        'Regardless of Nate\'s decision, does it sound like Nate has underlying moral principles that are good, bad, or somewhere in between?',
        'Regardless of Nate\'s decision, do you think Nate has moral standards that are good, bad, or somewhere in between?',
        'Regardless of Nate\'s decision, do you think Nate possesses the moral knowledge and principles necessary to do ‘the right thing’?',
        'Would you say Nate was quite certain in his decision, or did Nate have hesitations about his or her decision?',
        'How close do you think Nate was to choosing the alternate course of action?',
        'How conflicted do you think Nate felt in making the decision?',
        'Based on the information provided, do you think Nate had many reservations about the decision?',
        'Do you think Nate was calm and emotionally contained while making the decision?',
        'To what extent do you think Nate became upset and acted without thinking?'
    ];

    nate_questions.forEach(question => {
        timeline.push({
            type: 'html-slider-response',
            stimulus: chosen_prompts.nate + `<p>${question} (1 = particularly slowly, 7 = particularly quickly)</p>`,
            labels: ['1', '2', '3', '4', '5', '6', '7'],
            min: 1,
            max: 7
        });
    });

    // Attention check question
    timeline.push({
        type: 'survey-text',
        questions: [
            {
                prompt: 'Please enter the name of either character mentioned in the prompts.',
                placeholder: 'Type here'
            }
        ],
        data: {
            correct_responses: ['Nate', 'nate', 'Justin', 'justin', 'NATE', 'JUSTIN']
        }
    });

    // Initialize and start jsPsych
    jsPsych.init({
        timeline: timeline,
        on_finish: function() {
            jsPsych.data.displayData();
        }
    });
</script>
</html>
