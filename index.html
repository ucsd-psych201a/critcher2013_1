<!DOCTYPE html>
<html>
<head>
   <title>Psychology Experiment</title>
   <!-- Load jsPsych and plugins -->
   <script src="https://unpkg.com/jspsych@8.0.0"></script>
   <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@2.0.0"></script>
   <script src="https://unpkg.com/@jspsych/plugin-html-button-response@2.0.0"></script>
   <script src="https://unpkg.com/@jspsych/plugin-survey-likert@2.0.0"></script>
   <script src="https://unpkg.com/@jspsych/plugin-survey-text@2.0.0"></script>
   <script src="https://unpkg.com/@jspsych-contrib/plugin-pipe"></script>
   <link href="https://unpkg.com/jspsych@8.0.0/css/jspsych.css" rel="stylesheet" type="text/css" />
</head>
<body></body>
<script>
  // Initialize jsPsych
  const jsPsych = initJsPsych({
    on_finish: function () {
      jsPsych.run([thankYouMessage]); // Display thank-you message at the end
    }
  });

  // Create timeline array
  const timeline = [];

  // Subject ID and filename for data
  const subject_id = jsPsych.randomization.randomID(10);
  const filename = `${subject_id}.csv`;

  // Random assignment to moral or immoral condition
  const condition = Math.random() > 0.5 ? 'moral' : 'immoral';

  // Log the condition in a dedicated trial
  const logCondition = {
    type: jsPsychHtmlButtonResponse,
    stimulus: `<p>Initializing experiment...</p>`,
    choices: ['Continue'],
    data: { condition: condition } // Log the condition once
  };
  timeline.push(logCondition);

  // Consent information
  const consentInfo = {
    type: jsPsychHtmlButtonResponse,
    stimulus: `
      <div class="consent-info">
        <h2>Consent Information</h2>
        <p>Consent text goes here...</p>
      </div>
    `,
    choices: ['Continue']
  };
  timeline.push(consentInfo);

  // Study instructions page
  const studyInstructions = {
    type: jsPsychHtmlButtonResponse,
    stimulus: `
      <h2>Instructions</h2>
      <p>Instructions text goes here...</p>
    `,
    choices: ['Continue']
  };
  timeline.push(studyInstructions);

  // Introduction prompt
  const intro = {
    type: jsPsychHtmlButtonResponse,
    stimulus: `
      <p>Intro text goes here...</p>
    `,
    choices: ['Continue']
  };
  timeline.push(intro);

  // Story prompts for each condition
  const moralPrompt = {
    type: jsPsychHtmlButtonResponse,
    stimulus: `
      <p>Justin's moral decision story goes here...</p>
    `,
    choices: ['Continue']
  };

  const immoralPrompt = {
    type: jsPsychHtmlButtonResponse,
    stimulus: `
      <p>Justin's immoral decision story goes here...</p>
    `,
    choices: ['Continue']
  };

  timeline.push(condition === 'moral' ? moralPrompt : immoralPrompt);

  // Justin-related questions
  const justinQuestions = [
    {
      prompt: 'Did Justin make his decision quickly or slowly?',
      labels: ['1 - Particularly slowly', '2', '3', '4', '5', '6', '7 - Particularly quickly']
    }
    // Add additional questions as needed...
  ];

  justinQuestions.forEach(question => {
    timeline.push({
      type: jsPsychSurveyLikert,
      preamble: condition === 'moral' ? 
        "Justin's moral story summary goes here..." : 
        "Justin's immoral story summary goes here...",
      questions: [{ prompt: question.prompt, labels: question.labels, required: true }]
    });
  });

  // Feedback question
  const feedbackQuestion = {
    type: jsPsychSurveyText,
    questions: [
      {
        prompt: "Do you have any feedback? Did you experience any issues? Please be descriptive. Thank you!",
        placeholder: "Enter your feedback here...",
        rows: 4,
        required: false
      }
    ]
  };
  timeline.push(feedbackQuestion);

  // Thank-you message
  const thankYouMessage = {
    type: jsPsychHtmlButtonResponse,
    stimulus: `
      <p>Thank you for participating!</p>
    `,
    choices: ['Finish'],
    on_finish: function() {
      window.location.href = "https://app.prolific.com/submissions/complete?cc=C99FVA42";
    }
  };

  // Save data action
  const save_data = {
    type: jsPsychPipe,
    action: "save",
    experiment_id: "J9NfO09GdvBM",
    filename: filename,
    data_string: () => jsPsych.data.get().csv()
  };
  timeline.push(save_data);

  // Run the experiment
  jsPsych.run(timeline);
</script>
</html>

